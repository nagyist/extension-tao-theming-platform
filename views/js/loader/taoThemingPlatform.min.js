define("taoThemingPlatform/controller/routes",[],function(){"use strict";return{Main:{actions:{index:"controller/theming/main"}}}}),define("taoThemingPlatform/controller/theming/main",["jquery","helpers","lib/farbtastic/farbtastic","ui/feedback","ui/uploader"],function($,helpers,farbtastic,feedback,uploader){return{start:function(){var self=this,$scope=$(".platform-theme-selector"),$triggers=$scope.find(".customizer-trigger"),$popups=$scope.find(".customizer-popup"),cssObject={},logoObject={};self._initUploader(),self._initPopups($triggers,$popups,cssObject),$(".save").off("click").on("click",function(){self._initConfirmBox($popups,cssObject,logoObject)}),$(
".file-uploader").on("upload.uploader",function(e,file,result){logoObject.logo=result,$.ajax({url:helpers._url("getBase64","Main","taoThemingPlatform"),method:"POST",data:{upload:result.uploaded_file},dataType:"json"}).done(function(response){response&&response.base64&&($(".logo").attr("src",response.base64),$(".icon-close").on("click",function(){$.ajax({url:helpers._url("getBase64","Main","taoThemingPlatform"),method:"POST",dataType:"json"}).done(function(response){response&&response.base64&&$(".logo").attr("src",response.base64)})}))})}),$("#link").on("change",function(){$(".logo").closest("a").attr("href",$(this).val()),logoObject.link=$(this).val()}),$(
"#message").on("change",function(){$(".logo").closest("a").attr("title",$(this).val()),logoObject.message=$(this).val()}),$(".download-css").on("click",function(){$.ajax({url:helpers._url("download","Main","taoThemingPlatform"),method:"GET",dataType:"json"}).done(function(response){})})},_initConfirmBox:function($popups,cssObject,logoObject){var confirmBox=$(".confirm-modal-feedback"),cancel=confirmBox.find(".cancel"),save=confirmBox.find(".save");confirmBox.find(".modal-close");confirmBox.modal({width:500}),save.off("click").on("click",function(){var isStable=$("#is-platform-stable").is(":checked"),loginMessage=$("#platform-login-message").val(),
loginField=$("#platform-login-label").val(),passwordField=$("#platform-password-label").val(),copyrightNotice=$("#platform-copyright-notice").val();$.ajax({url:helpers._url("saveTheme","Main","taoThemingPlatform")+"/",contentType:"application/x-www-form-urlencoded; charset=UTF-8",method:"POST",data:{css:cssObject,logo:logoObject,stable:isStable,login_msg:loginMessage,login_field:loginField,password_field:passwordField,copyright_notice:copyrightNotice},dataType:"json"}).done(function(response){response&&response.success?(feedback().success(response.message),$popups.not('[style="display: none;"]').hide()):feedback().error(response.message)}),confirmBox.modal(
"close")}),cancel.off("click").on("click",function(){confirmBox.modal("close")})},_initPopups:function($triggers,$popups,cssObject){var self=this;$triggers.on("click",function(e){var $elt=$(this),$popup=$($elt.data("popup")),$closer=$(".closer",$popup);e.preventDefault(),e.stopPropagation(),$popups.not($popup).hide(),$(document).on("keyup",function(e){if(27===e.keyCode)return $popup.hide(),!1}),$closer.on("click",function(){$popup.hide()}),$(".color-picker",$popup).each(function(){var $this=$(this),$input=$($this.find("input"));$this.on("colorchange.farbtastic",function(e,color){var type=$this.hasClass("background")?"background":"color",local=$elt.data(
"local")||$elt,target=$elt.data("target"),local=($(local).each(function(){self._updatePreview($(this),color,type,cssObject)}),$input.val(color),color=$elt.data("important")?color+" !important":color,$input.attr("name"));cssObject[local]={selector:target,value:color}}),self._initializeColorPicker($this,$input)}),$popup.show()})},_initUploader:function(){var $uploadContainer=$("#upload-stylesheet");$uploadContainer.on("upload.uploader",function(e,file,interactionHook){interactionHook.error?feedback().error(interactionHook.error):feedback().success(interactionHook.success)}),$uploadContainer.on("fail.uploader",function(e,file,interactionHook){feedback().error(
interactionHook.message)}),$uploadContainer.uploader({uploadUrl:$uploadContainer.data("url")})},_initializeColorPicker:function($container,input){input=input.val();$.farbtastic($container).setColor(input)},_updatePreview:function($container,color,type,cssObject){var res,calculatedColor,oldStyle=$container.attr("style"),newStyle=oldStyle;newStyle=void 0===oldStyle?type+":"+color+" !important":-1===oldStyle.indexOf(type)?oldStyle+" "+type+":"+color+" !important":(res=new RegExp(type+":[^;]+").exec(oldStyle),oldStyle.replace(res,type+":"+color+" !important;")),$container.attr("style",newStyle),"color"===type&&$container.hasClass("action-bar")&&(
calculatedColor=$container.css(type).replace("rgb","rgba").replace(")",",.3)"),$container.find(".btn-info").css("border-color",calculatedColor),cssObject["action-border-color"]={selector:$container.data("calculus"),value:calculatedColor}),"background"===type&&$container.hasClass("active")&&(calculatedColor=$container.css(type).replace("rgb","rgba").replace(")",",.5)"),$("<style>.main-menu li a:hover{background:"+calculatedColor+" !important;}</style>").appendTo("head"),cssObject["hover-background"]={selector:$container.data("calculus"),value:calculatedColor})}}}),define("taoThemingPlatform/loader/taoThemingPlatform.bundle",function(){});
//# sourceMappingURL=taoThemingPlatform.min.js.map